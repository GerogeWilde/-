//=====================================================================
//                         4*4键盘扫描程序
//硬件连接: 4*4键盘的8个引脚接51的P1口
//扫描返回值为0―15	  
//=====================================================================

#include <STC89C51RC.h>      //STC单片机头文件

#define uchar unsigned char

uchar Key_Get(void)
{
    uchar temp;
	uchar a;

    a=0xff;
    P1=0xfe;
	temp=P1&0xf0;
	if(temp==0xe0) while(temp==0xe0){ P1=0xfe;temp=P1&0xf0; a=0x00; }
	if(temp==0xd0) while(temp==0xd0){ P1=0xfe;temp=P1&0xf0; a=0x04; }
	if(temp==0xb0) while(temp==0xb0){ P1=0xfe;temp=P1&0xf0; a=0x08;	}
	if(temp==0x70) while(temp==0x70){ P1=0xfe;temp=P1&0xf0; a=0x0c;	}

	P1=0xfd;
	temp=P1&0xf0;
	if(temp==0xe0) while(temp==0xe0){ P1=0xfd;temp=P1&0xf0; a=0x01;	}
	if(temp==0xd0) while(temp==0xd0){ P1=0xfd;temp=P1&0xf0; a=0x05;	}
	if(temp==0xb0) while(temp==0xb0){ P1=0xfd;temp=P1&0xf0; a=0x09;	}
	if(temp==0x70) while(temp==0x70){ P1=0xfd;temp=P1&0xf0; a=0x0d;	}
	
	P1=0xfb;
	temp=P1&0xf0;  
	if(temp==0xe0) while(temp==0xe0){ P1=0xfb;temp=P1&0xf0; a=0x02;	}
	if(temp==0xd0) while(temp==0xd0){ P1=0xfb;temp=P1&0xf0; a=0x06;	}
	if(temp==0xb0) while(temp==0xb0){ P1=0xfb;temp=P1&0xf0; a=0x0a;	}
	if(temp==0x70) while(temp==0x70){ P1=0xfb;temp=P1&0xf0; a=0x0e;	}

	P1=0xf7;
	temp=P1&0xf0;
	if(temp==0xe0) while(temp==0xe0){ P1=0xf7;temp=P1&0xf0; a=0x03;	}
	if(temp==0xd0) while(temp==0xd0){ P1=0xf7;temp=P1&0xf0; a=0x07;	}
	if(temp==0xb0) while(temp==0xb0){ P1=0xf7;temp=P1&0xf0; a=0x0b;	}
	if(temp==0x70) while(temp==0x70){ P1=0xf7;temp=P1&0xf0; a=0x0f;	}
	
	return(a);    
}