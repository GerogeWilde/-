C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 1   


C51 COMPILER V8.02, COMPILATION OF MODULE MENU
OBJECT MODULE PLACED IN menu.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE menu.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //=====================================================================
   2          //                    液晶显示模块 程序设计
   3          //文件名：menu.c
   4          //writer:谷雨 2008年8月25日于EDA实验室
   5          //说明： 本程序中函数void show_SIN(void)比较乱，组织的不太好
   6          //=====================================================================
   7          
   8          #include <STC89C51RC.h>      //STC单片机头文件
   9          #include "AD9854.h"  
  10          #include "ocmj.h"
  11          #include "key.h"
  12          
  13          #define uint  unsigned int
  14          #define uchar unsigned char
  15          
  16          static void delay_1 (uint us); 
  17          static void delay_1000 (uint us);
  18          
  19          extern void show_FSK(void);
  20          extern void show_RFSK(void);
  21          extern void show_BPSK(void);
  22          extern void show_OSK(void);      
  23          extern void show_AM(void);
  24          extern void show_SIN(void);
  25          static void SIN_IN(uchar key);
  26          
  27          uchar code img[]={
  28          /*--  宽度x高度=128x64  --*/
  29          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  30          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  31          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  32          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  33          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  34          0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x80,0x00,0x0F,0xFF,0x00,0x00,0x00,0x00,0x00,
  35          0x00,0x00,0x00,0x00,0x0C,0x43,0x01,0x80,0x00,0x7F,0xFF,0xF0,0x00,0x00,0x00,0x00,
  36          0x00,0x00,0x00,0x00,0x19,0xFF,0x07,0x00,0x07,0xFF,0xFF,0xFE,0x00,0x00,0x00,0x00,
  37          0x00,0x00,0x00,0x01,0x3F,0xFC,0x1E,0x00,0x1F,0xFF,0xFF,0xFF,0x80,0x00,0x00,0x00,
  38          0x00,0x00,0x00,0x01,0xBF,0xFF,0xFC,0x00,0x7F,0xFC,0x00,0x7F,0xC0,0x00,0x00,0x00,
  39          0x00,0x00,0x00,0x01,0xFF,0xFF,0xF0,0x00,0xFF,0xC0,0x00,0x0F,0xE0,0x00,0x00,0x00,
  40          0x00,0x00,0x00,0x01,0xFF,0xFF,0xE0,0x03,0xFF,0xFF,0xFC,0x01,0xF0,0x00,0x00,0x00,
  41          0x00,0x00,0x00,0x01,0xDF,0xFF,0xC0,0x07,0xFF,0xFF,0xFF,0x80,0xF0,0x00,0x00,0x00,
  42          0x00,0x00,0x00,0x03,0xFF,0xFF,0x00,0x0F,0xFF,0xFF,0xFF,0xE0,0x38,0x00,0x00,0x00,
  43          0x00,0x00,0x00,0x07,0xFF,0xF8,0x00,0x1F,0xFF,0xF0,0x03,0xF8,0x38,0x00,0x00,0x00,
  44          0x00,0x00,0x00,0x07,0xFF,0xE0,0x00,0x3F,0xFF,0xFF,0xC0,0x7C,0x18,0x00,0x00,0x00,
  45          0x00,0x00,0x00,0x04,0x7F,0xF0,0x00,0x3F,0xFF,0xFF,0xF8,0x1E,0x08,0x00,0x00,0x00,
  46          0x00,0x00,0x00,0x01,0xFF,0xF8,0x00,0x7F,0xFF,0xFF,0xFE,0x0F,0x08,0x00,0x00,0x00,
  47          0x00,0x00,0x00,0x0F,0xFF,0xFC,0x00,0xFF,0xFF,0xFF,0xFF,0x87,0x08,0x00,0x00,0x00,
  48          0x00,0x00,0x00,0x1F,0xFF,0xFE,0x00,0xFF,0xFF,0xFF,0xFF,0x83,0x88,0x00,0x00,0x00,
  49          0x00,0x00,0x00,0x3F,0xFF,0xFE,0x01,0xFF,0xFF,0xFF,0xFF,0xC3,0x88,0x00,0x00,0x00,
  50          0x00,0x00,0x00,0x7F,0xFF,0xFE,0x01,0xFF,0xFF,0xFF,0xFF,0xE1,0x88,0x00,0x00,0x00,
  51          0x00,0x00,0x00,0xFF,0xFF,0xFE,0x03,0xFF,0xFF,0xFF,0xFF,0xE1,0x88,0x00,0x00,0x00,
  52          0x00,0x00,0x01,0xFF,0xFF,0xFE,0x03,0xFF,0xFF,0xFF,0xFF,0xF1,0x88,0x00,0x00,0x00,
  53          0x00,0x00,0x01,0xFF,0xFF,0xFE,0x03,0xFF,0xFF,0xFF,0xFF,0xF3,0x08,0x00,0x00,0x00,
  54          0x00,0x00,0x01,0xFF,0xFF,0xFF,0x07,0xFF,0xFF,0xFF,0xFF,0xF2,0x10,0x00,0x00,0x00,
  55          0x00,0x00,0x01,0xFF,0xFF,0xFF,0x8F,0xFF,0xFF,0xFF,0xFF,0xF0,0x20,0x00,0x00,0x00,
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 2   

  56          0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF0,0x00,0x00,0x00,0x00,
  57          0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x70,0x00,0x00,0x00,0x00,
  58          0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFF,0x70,0x00,0x00,0x00,0x00,
  59          0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFF,0x70,0x00,0x00,0x00,0x00,
  60          0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0xFF,0x7F,0x20,0x00,0x00,0x00,0x00,
  61          0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xBF,0xFF,0x7F,0x20,0x00,0x00,0x00,0x00,
  62          0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFF,0xFF,0xDF,0xFF,0x7E,0x20,0x00,0x00,0x00,0x00,
  63          0x00,0x00,0x00,0x3F,0xFF,0xFF,0xFF,0xFF,0xDF,0xFF,0x3E,0x40,0x00,0x00,0x00,0x00,
  64          0x00,0x00,0x00,0x1F,0xFF,0xFF,0xFF,0xFF,0xCF,0xFF,0x3C,0x40,0x00,0x00,0x00,0x00,
  65          0x00,0x00,0x00,0x0F,0xFF,0xFF,0xFF,0xFF,0xCF,0xFE,0x38,0x40,0x00,0x00,0x00,0x00,
  66          0x00,0x00,0x00,0x07,0xFF,0xFF,0xFF,0xFF,0x8F,0xFE,0x38,0x40,0x00,0x00,0x00,0x00,
  67          0x00,0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0x8F,0xFE,0x30,0x40,0x00,0x00,0x00,0x00,
  68          0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x1F,0x7C,0x20,0x40,0x00,0x00,0x00,0x00,
  69          0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFE,0x1E,0x78,0x00,0x40,0x00,0x00,0x00,0x00,
  70          0x00,0x00,0x00,0x00,0x3F,0xFF,0xFF,0xFE,0x1E,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,
  71          0x00,0x00,0x00,0x00,0x1F,0xFF,0xFF,0xDA,0x3C,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,
  72          0x00,0x00,0x00,0x00,0x07,0xFF,0xFF,0xF2,0x30,0x80,0x00,0x00,0x00,0x00,0x00,0x00,
  73          0x00,0x00,0x00,0x00,0x01,0xFF,0xFF,0xF1,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  74          0x00,0x00,0x00,0x00,0x00,0xFE,0x7F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  75          0x00,0x00,0x00,0x00,0x00,0x7C,0x3F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  76          0x00,0x00,0x00,0x00,0x00,0x78,0x1F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  77          0x00,0x00,0x00,0x00,0x00,0x72,0x07,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  78          0x00,0x00,0x00,0x00,0x00,0x70,0x00,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  79          0x00,0x00,0x00,0x00,0x00,0x60,0x00,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  80          0x00,0x00,0x00,0x00,0x00,0x60,0x00,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  81          0x00,0x00,0x00,0x00,0x00,0xC0,0x03,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  82          0x00,0x00,0x00,0x00,0x01,0x40,0x04,0xD8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  83          0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  84          0x00,0x00,0x00,0x00,0x02,0x0C,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  85          0x00,0x00,0x00,0x00,0x02,0x40,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  86          0x00,0x00,0x00,0x00,0x0C,0x48,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  87          0x00,0x00,0x00,0x00,0x38,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  88          0x00,0x00,0x00,0x0F,0xE2,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  89          0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  90          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  91          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  92          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  93          };
  94          
  95          //================================================================= 
  96          // 函数名称 ：void delay (uint us)
  97          // 函数功能 ：小延时
  98          // 入口参数 ：us  延时时间的长短
  99          // 出口参数 ：无
 100          //=================================================================
 101          void delay_1 (uint us)   
 102          {
 103   1        while(us--);
 104   1      }  
 105          
 106          //================================================================= 
 107          // 函数名称 ：void delay_1000 (uint us)
 108          // 函数功能 ：大延时
 109          // 入口参数 ：us  延时时间的长短
 110          // 出口参数 ：无
 111          //=================================================================
 112          void delay_1000 (uint us)   
 113          {
 114   1        while(us--)
 115   1        {
 116   2                delay_1(1000);
 117   2        }
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 3   

 118   1      } 
 119          
 120          //================================================================= 
 121          // 函数名称 ：void show_kaiji(void)
 122          // 函数功能 ：显示开机界面
 123          // 入口参数 ：无
 124          // 出口参数 ：无
 125          //=================================================================
 126          void show_kaiji(void)   
 127          {
 128   1              lat_disp (0xcc,0xcc);     //显示点阵
 129   1          delay_1000(300);
 130   1      
 131   1              clear();
 132   1              lat_disp (0xff,0x00);    //显示点阵
 133   1              delay_1000(300);
 134   1      
 135   1              clear();
 136   1              send_img(img);         //显示图像
 137   1              delay_1000(300);
 138   1      
 139   1              clear();   
 140   1              set_position(0,0);
 141   1              send_str("基于DDS 内核的");
 142   1              set_position(1,0);
 143   1              send_str("多功能高频实验仪");
 144   1              set_position(2,0);
 145   1              send_str("作者: 王波涛");
 146   1              set_position(3,0);      
 147   1              send_str("学院：光电学院");
 148   1              delay_1000(1000);                               
 149   1      }
 150          
 151          //================================================================= 
 152          // 函数名称 ：void show_select(void)
 153          // 函数功能 ：显示输入功能界面
 154          // 入口参数 ：无
 155          // 出口参数 ：无
 156          //=================================================================
 157          void show_select(void)
 158          {
 159   1          clear();
 160   1      
 161   1              set_position(0,0);
 162   1              send_str("  请选择功能键");
 163   1              set_position(1,0);
 164   1              send_str("  SIN     FSK");
 165   1              set_position(2,0);
 166   1              send_str("  RFSK    BPSK");
 167   1              set_position(3,0);
 168   1              send_str("  OSK     AM");
 169   1      }
 170          
 171          //================================================================= 
 172          // 函数名称 ：void show_error(void)
 173          // 函数功能 ：输入错误提示
 174          // 入口参数 ：无
 175          // 出口参数 ：无
 176          //=================================================================
 177          void show_error(void)
 178          {
 179   1              uchar i;
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 4   

 180   1              for(i=0;i<3;i++)
 181   1              {
 182   2                      clear();
 183   2                      delay_1000(45);
 184   2                      set_position(1,0);
 185   2                      send_str("  您的输入错误");
 186   2                      set_position(2,0);
 187   2                      send_str("  请您重新输入");
 188   2                      delay_1000(45);
 189   2              }
 190   1              show_select();  
 191   1      }
 192          
 193          //================================================================= 
 194          // 函数名称 ：void show_FSK(void)
 195          // 函数功能 ：FSK操作界面
 196          // 入口参数 ：无
 197          // 出口参数 ：无
 198          //=================================================================
 199          void show_FSK(void)
 200          {
 201   1              uchar key,i;
 202   1              
 203   1              uchar code tab[]={0xd5,0xfd};   //“正”字显示不出来，用内码显示
 204   1      
 205   1              clear();
 206   1      
 207   1              set_position(1,0);
 208   1              send_str("您选择了FSK 功能");
 209   1              set_position(2,1);
 210   1              send_str("请确定或退出");
 211   1              
 212   1              key=0xff;       
 213   1      
 214   1              while(key==0xff)        //等待有键按下
 215   1              {
 216   2                      key=Key_Get();
 217   2              }
 218   1      
 219   1              if(key==15)                              //按下确定键
 220   1              {       
 221   2                      AD9854_InitFSK();
 222   2                      AD9854_SetFSK(1000,100000);      //FSK低频和高频分别为1K和100K
 223   2      
 224   2                      clear();
 225   2                      set_position(1,0);
 226   2                      send_chin(tab);
 227   2                      set_position(1,1);
 228   2                      send_str("在进行FSK 操作");
 229   2                      set_position(2,0);
 230   2                      send_str("请按任意键返回");
 231   2      
 232   2                      while(Key_Get()==0xff)
 233   2                      {
 234   3                              AD9854_FDATA = 1;
 235   3                              delay_1000(10);       //延时时间长，便于观察
 236   3                              AD9854_FDATA = 0;
 237   3                              delay_1000(9);
 238   3                      }
 239   2      
 240   2                      AD9854_Init();                    //AD9854初始化，以关闭FSK
 241   2      
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 5   

 242   2                      show_select();                    //显示选择功能界面
 243   2              }
 244   1              else if(key==14)
 245   1              {
 246   2                      for(i=0;i<3;i++)
 247   2                      {
 248   3                              clear();
 249   3                              delay_1000(45);
 250   3                              set_position(1,1);
 251   3                              send_str("您选择了退出");
 252   3                              delay_1000(45);
 253   3                      }
 254   2                      show_select();                    //显示选择功能界面
 255   2              }
 256   1              else
 257   1              {
 258   2                      show_error();                    //错误提示
 259   2                      show_FSK();             
 260   2              }                       
 261   1      }
 262          
 263          //================================================================= 
 264          // 函数名称 ：void show_RFSK(void)
 265          // 函数功能 ：FSK操作界面
 266          // 入口参数 ：无
 267          // 出口参数 ：无
 268          //=================================================================
 269          void show_RFSK(void)
 270          {
 271   1              uchar key,i;
 272   1              
 273   1              uchar code tab[]={0xd5,0xfd};   //“正”字显示不出来，用内码显示
 274   1      
 275   1              clear();
 276   1      
 277   1              set_position(1,0);
 278   1              send_str("您选择了RFSK功能");
 279   1              set_position(2,1);
 280   1              send_str("请确定或退出");
 281   1              
 282   1              key=0xff;       
 283   1      
 284   1              while(key==0xff)                 //等待有键按下
 285   1              {
 286   2                      key=Key_Get();
 287   2              }
 288   1      
 289   1              if(key==15)                                       //按下确定键
 290   1              {       
 291   2                      AD9854_InitRFSK();
 292   2                      AD9854_SetRFSK(1000,100000,50,20);       
 293   2      
 294   2                      clear();
 295   2                      set_position(1,0);
 296   2                      send_chin(tab);
 297   2                      set_position(1,1);
 298   2                      send_str("在进行RFSK操作");
 299   2                      set_position(2,0);
 300   2                      send_str("请按任意键返回");
 301   2      
 302   2                      while(Key_Get()==0xff)
 303   2                      {
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 6   

 304   3                              AD9854_FDATA = 1;
 305   3                              delay_1000(10);       //延时时间长，便于观察
 306   3                              AD9854_FDATA = 0;
 307   3                              delay_1000(9);
 308   3                      }
 309   2      
 310   2                      AD9854_Init();                    //AD9854初始化，以关闭RFSK
 311   2      
 312   2                      show_select();                    //显示选择功能界面
 313   2              }
 314   1              else if(key==14)
 315   1              {
 316   2                      for(i=0;i<3;i++)
 317   2                      {
 318   3                              clear();
 319   3                              delay_1000(45);
 320   3                              set_position(1,1);
 321   3                              send_str("您选择了退出");
 322   3                              delay_1000(45);
 323   3                      }
 324   2                      show_select();                    //显示选择功能界面
 325   2              }
 326   1              else
 327   1              {
 328   2                      show_error();                    //错误提示
 329   2                      show_RFSK();             
 330   2              }               
 331   1      }
 332          
 333          //================================================================= 
 334          // 函数名称 ：void show_BPSK(void)
 335          // 函数功能 ：BPSK操作界面
 336          // 入口参数 ：无
 337          // 出口参数 ：无
 338          //=================================================================
 339          void show_BPSK(void)
 340          {
 341   1              uchar key,i;
 342   1              
 343   1              uchar code tab[]={0xd5,0xfd};   //“正”字显示不出来，用内码显示
 344   1      
 345   1              clear();
 346   1      
 347   1              set_position(1,0);
 348   1              send_str("您选择了BPSK功能");
 349   1              set_position(2,1);
 350   1              send_str("请确定或退出");
 351   1              
 352   1              key=0xff;       
 353   1      
 354   1              while(key==0xff)                 //等待有键按下
 355   1              {
 356   2                      key=Key_Get();
 357   2              }
 358   1      
 359   1              if(key==15)                                       //按下确定键
 360   1              {       
 361   2                      AD9854_InitBPSK();
 362   2                      AD9854_SetBPSK(0,8192);  //设置相位
 363   2      
 364   2                      clear();
 365   2                      set_position(1,0);
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 7   

 366   2                      send_chin(tab);
 367   2                      set_position(1,1);
 368   2                      send_str("在进行BPSK操作");
 369   2                      set_position(2,0);
 370   2                      send_str("请按任意键返回");
 371   2      
 372   2                      while(Key_Get()==0xff)
 373   2                      {
 374   3                              AD9854_FDATA = 1;
 375   3                              delay_1(20);          //延时时间长，便于观察
 376   3                              AD9854_FDATA = 0;
 377   3                              delay_1(5);
 378   3                      }
 379   2      
 380   2                      AD9854_Init();                    //AD9854初始化，以关闭BPSK
 381   2      
 382   2                      show_select();                    //显示选择功能界面
 383   2              }
 384   1              else if(key==14)
 385   1              {
 386   2                      for(i=0;i<3;i++)
 387   2                      {
 388   3                              clear();
 389   3                              delay_1000(45);
 390   3                              set_position(1,1);
 391   3                              send_str("您选择了退出");
 392   3                              delay_1000(45);
 393   3                      }
 394   2                      show_select();                    //显示选择功能界面
 395   2              }
 396   1              else
 397   1              {
 398   2                      show_error();                    //错误提示
 399   2                      show_BPSK();             
 400   2              }               
 401   1      }
 402          
 403          //================================================================= 
 404          // 函数名称 ：void show_OSK(void);
 405          // 函数功能 ：OSK操作界面
 406          // 入口参数 ：无
 407          // 出口参数 ：无
 408          //=================================================================
 409          void show_OSK(void)
 410          {
 411   1              uchar key,i;
 412   1              
 413   1              uchar code tab[]={0xd5,0xfd};   //“正”字显示不出来，用内码显示
 414   1      
 415   1              clear();
 416   1      
 417   1              set_position(1,0);
 418   1              send_str("您选择了OSK 功能");
 419   1              set_position(2,1);
 420   1              send_str("请确定或退出");
 421   1              
 422   1              key=0xff;       
 423   1      
 424   1              while(key==0xff)                 //等待有键按下
 425   1              {
 426   2                      key=Key_Get();
 427   2              }
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 8   

 428   1      
 429   1              if(key==15)                                       //按下确定键
 430   1              {       
 431   2                      AD9854_InitOSK();
 432   2                      AD9854_SetOSK(10);       //设置斜率
 433   2      
 434   2                      clear();
 435   2                      set_position(1,0);
 436   2                      send_chin(tab);
 437   2                      set_position(1,1);
 438   2                      send_str("在进行OSK 操作");
 439   2                      set_position(2,0);
 440   2                      send_str("请按任意键返回");
 441   2      
 442   2                      while(Key_Get()==0xff)
 443   2                      {
 444   3                              AD9854_OSK=1;   
 445   3                              delay_1(30); 
 446   3                              AD9854_OSK=0;   
 447   3                              delay_1(30);
 448   3                      }
 449   2      
 450   2                      AD9854_Init();                    //AD9854初始化，以关闭OSK
 451   2      
 452   2                      show_select();                    //显示选择功能界面
 453   2              }
 454   1              else if(key==14)
 455   1              {
 456   2                      for(i=0;i<3;i++)
 457   2                      {
 458   3                              clear();
 459   3                              delay_1000(45);
 460   3                              set_position(1,1);
 461   3                              send_str("您选择了退出");
 462   3                              delay_1000(45);
 463   3                      }
 464   2                      show_select();                    //显示选择功能界面
 465   2              }
 466   1              else
 467   1              {
 468   2                      show_error();                    //错误提示
 469   2                      show_OSK();             
 470   2              }                               
 471   1      }
 472          
 473          //================================================================= 
 474          // 函数名称 ：void show_AM(void);
 475          // 函数功能 ：OSK操作界面
 476          // 入口参数 ：无
 477          // 出口参数 ：无
 478          //=================================================================
 479          void show_AM(void)
 480          {
 481   1              uchar key;
 482   1              uchar i;
 483   1              
 484   1              uchar code tab[]={0xd5,0xfd};   //“正”字显示不出来，用内码显示
 485   1      
 486   1              clear();
 487   1      
 488   1              set_position(1,0);
 489   1              send_str("您选择了AM功能");
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 9   

 490   1              set_position(2,1);
 491   1              send_str("请确定或退出");
 492   1              
 493   1              key=0xff;       
 494   1      
 495   1              while(key==0xff)                 //等待有键按下
 496   1              {
 497   2                      key=Key_Get();
 498   2              }
 499   1      
 500   1              if(key==15)                                       //按下确定键
 501   1              {       
 502   2                      AD9854_InitAM();
 503   2      
 504   2                      clear();
 505   2                      set_position(1,0);
 506   2                      send_chin(tab);
 507   2                      set_position(1,1);
 508   2                      send_str("在进行AM操作");
 509   2                      set_position(2,0);
 510   2                      send_str("请按任意键返回");
 511   2      
 512   2                      while(Key_Get()==0xff)
 513   2                      {
 514   3                              AD9854_SetAM(2000);
 515   3                              delay_1(10);          
 516   3                              AD9854_SetAM(4000);
 517   3                              delay_1(10);
 518   3                      }
 519   2      
 520   2                      AD9854_Init();                    //AD9854初始化，以关闭AM
 521   2      
 522   2                      show_select();                    //显示选择功能界面
 523   2              }
 524   1              else if(key==14)
 525   1              {
 526   2                      for(i=0;i<3;i++)
 527   2                      {
 528   3                              clear();
 529   3                              delay_1000(45);
 530   3                              set_position(1,1);
 531   3                              send_str("您选择了退出");
 532   3                              delay_1000(45);
 533   3                      }
 534   2                      show_select();                    //显示选择功能界面
 535   2              }
 536   1              else
 537   1              {
 538   2                      show_error();                    //错误提示
 539   2                      show_AM();             
 540   2              }               
 541   1      }
 542          
 543          //================================================================= 
 544          // 函数名称 ：void show_SIN(void)
 545          // 函数功能 ：正弦波产生操作界面
 546          // 入口参数 ：无
 547          // 出口参数 ：无
 548          //=================================================================
 549          void show_SIN(void)
 550          {
 551   1              uchar code tab[]={0xd5,0xfd};       //“请输入正弦波频率”的“正”字显示不出来，用内码显示
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 10  

 552   1              uchar key;
 553   1              uint i;
 554   1      
 555   1              clear();
 556   1      
 557   1              set_position(0,0);
 558   1              send_str("您选择了SIN 功能");
 559   1              set_position(1,0);
 560   1              send_str("请输入");
 561   1              set_position(1,3);
 562   1              send_str(tab); 
 563   1              set_position(1,4);
 564   1              send_str("弦波频率"); 
 565   1              set_position(2,0); 
 566   1              send_str("  频率输入范围: "); 
 567   1              set_position(3,0); 
 568   1              send_str("     0~50MHZ    ");   
 569   1      
 570   1              key=0xff;       
 571   1      
 572   1              while(key==0xff)                 //等待有键按下
 573   1              {
 574   2                      key=Key_Get();
 575   2              }
 576   1      
 577   1      
 578   1              if((key>=1)&&(key<=9))             //第一次按键处理
 579   1              {
 580   2                      SIN_IN(key);    
 581   2              }
 582   1              else if(key==14)
 583   1              {
 584   2                      for(i=0;i<3;i++)
 585   2                      {
 586   3                              clear();
 587   3                              delay_1000(45);
 588   3                              set_position(1,1);
 589   3                              send_str("您选择了退出");
 590   3                              delay_1000(45);
 591   3                      }
 592   2                      show_select();                    //显示选择功能界面
 593   2              }
 594   1              else
 595   1              {
 596   2                      show_error();                    //错误提示
 597   2                      show_SIN(); 
 598   2              }
 599   1      }
 600          
 601          //================================================================= 
 602          // 函数名称 ：void SIN_IN(uchar key)
 603          // 函数功能 ：正弦波输入参数处理
 604          // 入口参数 ：key  上次按键的键值
 605          // 出口参数 ：无
 606          //=================================================================
 607          void SIN_IN(uchar key)
 608          {
 609   1              bit ERROR=0;                        //错误标志位
 610   1              bit IN_OVRE=0;                                          //输入完毕标志
 611   1              bit Clear=0;                                            //清零标志
 612   1              ulong freq;                         //长整形频率
 613   1              uchar key_buf[8];                                       //输入参数保存数组
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 11  

 614   1              uchar num;                                                      //输入参数计数变量
 615   1              uchar freq_unit;                                    //频率单位变量
 616   1              bit Flag=0;                                                     //输入正确标志
 617   1          uchar i;
 618   1      
 619   1              key_buf[0]=key;                                      //将按键存入数组
 620   1              num=1;                                                           //数组内标为1
 621   1      
 622   1              clear();                   //清屏
 623   1                      
 624   1              set_position(0,0);
 625   1              send_str("您输入的频率为:");
 626   1              set_position(1,0);
 627   1              send_char(key+48);
 628   1      
 629   1              while(1)
 630   1              {
 631   2                      key=0xff;       
 632   2      
 633   2                      while(key==0xff)                 //等待有键按下
 634   2                      {
 635   3                              key=Key_Get();
 636   3                      }
 637   2      
 638   2                      switch(key)
 639   2                      {
 640   3                              case 0:
 641   3                              case 1:
 642   3                              case 2:
 643   3                              case 3:
 644   3                              case 4:
 645   3                              case 5:
 646   3                              case 6:
 647   3                              case 7:
 648   3                              case 8:
 649   3                              case 9:
 650   3                                      send_char(key+48); 
 651   3                                      if(num<8)
 652   3                                      {
 653   4                                              key_buf[num]=key;                                            //将按键存入数组
 654   4                                              num++;
 655   4                                      }
 656   3                                      else
 657   3                                      {
 658   4                                              for(i=0;i<3;i++)
 659   4                                              {
 660   5                                                      clear();
 661   5                                                      delay_1000(45);
 662   5                                                      set_position(1,1);
 663   5                                                      send_str("您的输入溢出");
 664   5                                                      set_position(2,1);
 665   5                                                      send_str("请您重新输入");
 666   5                                                      delay_1000(45);
 667   5                                              }
 668   4                                              Clear=1;                   //清零标志置位
 669   4                                      }             
 670   3                                      break;  
 671   3                              case 10:
 672   3                                      send_char('H');
 673   3                                      send_char('Z');
 674   3                                      freq_unit=1;               //频率单位变量置为1
 675   3                                      IN_OVRE=1;                    //输入完毕
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 12  

 676   3                                      break;
 677   3                              case 11:
 678   3                                      send_char('K');
 679   3                                      send_char('H');
 680   3                                      send_char('Z');
 681   3                                      freq_unit=2;               //频率单位变量置为2
 682   3                                      IN_OVRE=1;                    //输入完毕
 683   3                                      break;
 684   3                              case 12:
 685   3                                      send_char('M');
 686   3                                      send_char('H');
 687   3                                      send_char('Z');
 688   3                                      freq_unit=3;               //频率单位变量置为3
 689   3                                      IN_OVRE=1;                    //输入完毕
 690   3                                      break;
 691   3                              case 13:
 692   3                                      for(i=0;i<3;i++)
 693   3                                      {
 694   4                                              clear();
 695   4                                              delay_1000(45);
 696   4                                              set_position(1,1);
 697   4                                              send_str("您选择了清零");
 698   4                                              set_position(2,1);
 699   4                                              send_str("请您重新输入");
 700   4                                              delay_1000(45);
 701   4                                      }
 702   3                                      Clear=1;                   
 703   3                                      break;
 704   3                              case 14:
 705   3                                      for(i=0;i<3;i++)
 706   3                                      {
 707   4                                              clear();
 708   4                                              delay_1000(45);
 709   4                                              set_position(1,1);
 710   4                                              send_str("您选择了退出");
 711   4                                              delay_1000(45);
 712   4                                      }
 713   3                                      ERROR=1;                 
 714   3                                      break;
 715   3                              case 15:
 716   3                                      show_error();
 717   3                                      ERROR=1;
 718   3                                      break;
 719   3                      }
 720   2      
 721   2                      if((ERROR==1)||(IN_OVRE==1)||(Clear==1))
 722   2                      {
 723   3                              break;                  //错误，退出循环
 724   3                      }
 725   2              }
 726   1      
 727   1              if(IN_OVRE==1)                       //输入完毕，等待确认
 728   1              {
 729   2                      freq=0;
 730   2      
 731   2                      for(i=0;i<num;i++)                        //计算输入频率
 732   2                      {       
 733   3                              freq = freq*10+key_buf[i];
 734   3                      }
 735   2      
 736   2                      switch(freq_unit)             //单位处理
 737   2                      {
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 13  

 738   3                              case 1:
 739   3                                      if(freq<=50000000)
 740   3                                      {
 741   4                                              Flag=1;           //输入正确标志置1
 742   4                                      }
 743   3                                      else
 744   3                                      {
 745   4                                              Flag=0;           //输入正确标志置0
 746   4                                      }
 747   3                                      break;
 748   3                              case 2:
 749   3                                      if(freq<=50000)
 750   3                                      {
 751   4                                              Flag=1;           //输入正确标志置1
 752   4                                              freq*=1000;
 753   4                                      }
 754   3                                      else
 755   3                                      {
 756   4                                              Flag=0;           //输入正确标志置0
 757   4                                      }
 758   3                                      break;
 759   3                              case 3:
 760   3                                      if(freq<=50)
 761   3                                      {
 762   4                                              Flag=1;           //输入正确标志置1
 763   4                                              freq*=1000000;
 764   4                                      }
 765   3                                      else
 766   3                                      {
 767   4                                              Flag=0;           //输入正确标志置0
 768   4                                      }
 769   3                                      break;
 770   3                              default:
 771   3                                      break;
 772   3                      }
 773   2      
 774   2                      if(Flag==1)
 775   2                      {
 776   3                              set_position(2,1);
 777   3                              send_str("您已输入频率");
 778   3                              set_position(3,1);
 779   3                              send_str("请确定或清零");
 780   3      
 781   3                              key=0xff;       
 782   3      
 783   3                              while(key==0xff)                 //等待有键按下
 784   3                              {
 785   4                                      key=Key_Get();
 786   4                              }
 787   3      
 788   3              loop:   if(key==15)                                       //按下确定键
 789   3                              {
 790   4                                      AD9854_Init();
 791   4                                      AD9854_SetSine(freq,4000);       
 792   4              
 793   4                                      clear_line(0);                  //清除第一行
 794   4                                      clear_line(2);                  //清除第二行
 795   4                                      clear_line(3);                  //清除第三行
 796   4              
 797   4                                      set_position(0,0);
 798   4                                      send_str("已经产生频率为");
 799   4                                      set_position(1,5);
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 14  

 800   4                                      send_str("的波形");
 801   4              
 802   4                                      set_position(2,0);
 803   4                                      send_str("请按任意键返回");
 804   4              
 805   4                                      while(Key_Get()==0xff);        //等待按键
 806   4              
 807   4                                      AD9854_Init();                        //AD9854初始化，以关闭波形产生
 808   4              
 809   4                                      show_select();                       //显示选择功能界面
 810   4                              }
 811   3                              else if(key==13)                                //清零处理
 812   3                              {
 813   4                                      for(i=0;i<3;i++)
 814   4                                      {
 815   5                                              clear();
 816   5                                              delay_1000(45);
 817   5                                              set_position(1,1);
 818   5                                              send_str("您选择了清零");
 819   5                                              set_position(2,1);
 820   5                                              send_str("请您重新输入");
 821   5                                              delay_1000(45);
 822   5                                      }
 823   4                                      Clear=1;        
 824   4                              }
 825   3                              else if(key==14)
 826   3                              {
 827   4                                      for(i=0;i<3;i++)
 828   4                                      {
 829   5                                              clear();
 830   5                                              delay_1000(45);
 831   5                                              set_position(1,1);
 832   5                                              send_str("您选择了退出");
 833   5                                              delay_1000(45);
 834   5                                      }
 835   4                                      Clear=1;
 836   4                              }
 837   3                              else                            
 838   3                              {
 839   4                                      while(key<13)
 840   4                                      {
 841   5                                              for(i=0;i<3;i++)
 842   5                                              {
 843   6                                                      clear_line(2);
 844   6                                                      clear_line(3);
 845   6                                                      delay_1000(45);
 846   6                                                      set_position(2,1);
 847   6                                                      send_str("您的输入错误");
 848   6                                                      set_position(3,1);
 849   6                                                      send_str("请您重新输入");
 850   6                                                      delay_1000(45);
 851   6                                              }
 852   5              
 853   5                                              clear_line(2);
 854   5                                              clear_line(3);
 855   5                                              set_position(2,1);
 856   5                                              send_str("您已输入频率");
 857   5                                              set_position(3,1);
 858   5                                              send_str("请确定或清零");
 859   5      
 860   5                                              key=0xff;       
 861   5      
C51 COMPILER V8.02   MENU                                                                  08/27/2008 15:24:54 PAGE 15  

 862   5                                              while(key==0xff)                 //等待有键按下
 863   5                                              {
 864   6                                                      key=Key_Get();
 865   6                                              }
 866   5                                      }
 867   4      
 868   4                                      goto loop;                               //程序没有办法调了，来了个goto
 869   4                              }       
 870   3                      }
 871   2                      else
 872   2                      {
 873   3                              delay_1000(120);
 874   3      
 875   3                              for(i=0;i<3;i++)
 876   3                              {
 877   4                                      clear();
 878   4                                      delay_1000(45);
 879   4                                      set_position(1,1);
 880   4                                      send_str("您的输入溢出");
 881   4                                      set_position(2,1);
 882   4                                      send_str("请您重新输入");
 883   4                                      delay_1000(45);
 884   4      
 885   4                                      Clear=1;                   //清零标志置位
 886   4                              }
 887   3                      }                       
 888   2              }
 889   1              if((Clear==1)||(ERROR==1))                         //错误、退出和清零处理
 890   1              {
 891   2                      show_SIN();
 892   2              }       
 893   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2703    ----
   CONSTANT SIZE    =   1563    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      30
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       4
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
