C51 COMPILER V7.09   DDS_TEST                                                              04/29/2010 10:54:21 PAGE 1   


C51 COMPILER V7.09, COMPILATION OF MODULE DDS_TEST
OBJECT MODULE PLACED IN DDS_TEST.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE DDS_TEST.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /////////////////////////////////////
   2          //  Generated Initialization File  //
   3          /////////////////////////////////////
   4          
   5          #include <c8051f020.h>
   6          #include <intrins.h>
   7          
   8          
   9          //---------------------------
  10          #define   ADDRESS   P2
  11          #define   DATA      P1
  12          #define   ulong     unsigned long 
  13          #define   uchar     unsigned char 
  14          
  15          sbit MASTER_RESET = P3^3;    
  16          sbit IO_UPDATE    = P3^4;
  17          sbit FBH          = P3^5;       //fsk/bpsk/hold
  18          sbit RD           = P3^6;
  19          sbit WR           = P3^7;
  20          sbit SHAPED_LEYING= P0^3;  
  21          
  22          uchar  temp;
  23          uchar  TAB_Data[40];
  24          
  25          ////////////////////////////////////////////
  26          ////////////////////////////////////////////
  27          /////////////////////////////////////////
  28          
  29          ulong  fre=10000000;//输出频率
  30          //////////////////////////////////////////
  31          ///////////////////////////////////////////
  32          //////////////////////////////////////////
  33          
  34          void AD9854_IO_INT();
  35          void TAB_DataWord(double);
  36          void V_init();
  37          
  38          
  39          //-----------------------
  40          void delay(long t)
  41          {   
  42   1        unsigned int i=0;
  43   1              while(t--)
  44   1              for(i=0;i<=1000;i++);
  45   1      }
  46          
  47          //--------------------------
  48          void update(void)   
  49          {
  50   1              IO_UPDATE=0; 
  51   1              delay(10);      
  52   1              IO_UPDATE=1;
  53   1      //      delay(0);
  54   1              
  55   1      }
C51 COMPILER V7.09   DDS_TEST                                                              04/29/2010 10:54:21 PAGE 2   

  56          
  57          //----------------------
  58          void Port_IO_Init()
  59          {
  60   1          
  61   1          P0MDOUT   = 0xff;
  62   1          P1MDOUT   = 0xFF;
  63   1          P2MDOUT   = 0xFF;
  64   1          P3MDOUT   = 0xFF;
  65   1          XBR2      = 0x40;
  66   1      }
  67          //-------------------------
  68          void Oscillator_Init()
  69          {
  70   1          OSCICN    = 0x07;
  71   1      }
  72          //---------------------------
  73          
  74          void Init_Device(void)
  75          {
  76   1          Port_IO_Init();
  77   1          Oscillator_Init();
  78   1      }
  79          
  80          ////////////////////////////////////////////////////////
  81          //**********************************************************
  82          void main (void)
  83          {
  84   1              
  85   1              WDTCN = 0xde;           //关看门狗
  86   1              WDTCN = 0xad;
  87   1      
  88   1              Init_Device();     
  89   1      
  90   1          V_init();   
  91   1              TAB_DataWord(fre);
  92   1              AD9854_IO_INT();
  93   1           while(1);
  94   1      
  95   1       }
  96          //////////////////////////////////////////////////////
  97          //****************************************************
  98          
  99          
 100          void TAB_DataWord(double f)
 101            
 102            {     
 103   1               
 104   1      
 105   1        //////////////////////////////////////////////////
 106   1       //------------ phase  turning word 1----------------
 107   1           TAB_Data[0]=0x00;   //高位
 108   1               TAB_Data[1]=0x00;   //低位
 109   1        //------------ phase  turning word 2----------------
 110   1               TAB_Data[2]=0x00;   //高位
 111   1               TAB_Data[3]=0x00;   //低位
 112   1      
 113   1      /////////////////////////////////////////////////
 114   1      //------------ frequency  turning word 1----------------
 115   1           TAB_Data[4]=((ulong)((f*256)/300000000))&(0x0000000000ff);//  0x00;//  //高位
 116   1               TAB_Data[5]=((ulong)((f*65536)/300000000))&(0x0000000000ff);//0x00;//
 117   1               TAB_Data[6]=((ulong)((f*16777216)/300000000))&(0x0000000000ff);//0x9f;//
C51 COMPILER V7.09   DDS_TEST                                                              04/29/2010 10:54:21 PAGE 3   

 118   1               TAB_Data[7]=((ulong)((f*4294967296)/300000000))&(0x0000000000ff);//0x16;//
 119   1               TAB_Data[8]=((ulong)((f*1099511627776)/300000000))&(0x0000000000ff);//0xb1;//
 120   1               TAB_Data[9]=((ulong)((f*281474976710656)/300000000))&(0x0000000000ff);//0x1c;//
 121   1      //------------ frequency  turning word 2----------------
 122   1           TAB_Data[10]=0x00;    //高位
 123   1               TAB_Data[11]=0x00;
 124   1               TAB_Data[12]=0x00;
 125   1               TAB_Data[13]=0x00;
 126   1               TAB_Data[14]=0x00;
 127   1               TAB_Data[15]=0x00;   
 128   1      /////////////////////////////////////////////////
 129   1      //------------ delta  frequency  word 1----------------
 130   1           TAB_Data[16]=0x00;    //高位
 131   1               TAB_Data[17]=0x00;
 132   1               TAB_Data[18]=0x00;
 133   1               TAB_Data[19]=0x00;
 134   1               TAB_Data[20]=0x00;
 135   1               TAB_Data[21]=0x00;     //低位   三角波  
 136   1      
 137   1      
 138   1      /////////////////////////////////////////////////
 139   1      //------------ update  clock----------------
 140   1           TAB_Data[22]=0x00;    //高位
 141   1               TAB_Data[23]=0x00;
 142   1               TAB_Data[24]=0x00;
 143   1               TAB_Data[25]=0x00;   //低位
 144   1      
 145   1      
 146   1      /////////////////////////////////////////////////
 147   1      //------------ ramp rate  clock----------------
 148   1               TAB_Data[26]=0x00;
 149   1               TAB_Data[27]=0x00; 
 150   1               TAB_Data[28]=0x00;  
 151   1      
 152   1      /////////////////////////////////////////////////
 153   1      //------------ 初始化预设----------------
 154   1           TAB_Data[29]=0x00;    //高位   
 155   1               TAB_Data[30]=0x00;    ///300M
 156   1               TAB_Data[31]=0x00;
 157   1               TAB_Data[32]=0x00;   //低位
 158   1      
 159   1      
 160   1      /////////////////////////////////////////////////
 161   1      //------------ output shape key  I Mul----------------
 162   1           TAB_Data[33]=0x00;       
 163   1               TAB_Data[34]=0x00; 
 164   1      //------------ output shape key  Q Mul----------------  
 165   1           TAB_Data[35]=0x00;       
 166   1               TAB_Data[36]=0x00;  
 167   1      
 168   1      
 169   1      /////////////////////////////////////////////////
 170   1      //------------ output shape key ramp rate-------------
 171   1           TAB_Data[37]=0x00; 
 172   1      
 173   1      
 174   1      
 175   1      /////////////////////////////////////////////////
 176   1      //------------QDAC-------------
 177   1           TAB_Data[38]=0x00; 
 178   1               TAB_Data[39]=0x00;
 179   1          
C51 COMPILER V7.09   DDS_TEST                                                              04/29/2010 10:54:21 PAGE 4   

 180   1              } 
 181          
 182          
 183          
 184          //***********************************************************
 185          void AD9854_IO_INT()
 186          {
 187   1         uchar i;
 188   1      
 189   1         MASTER_RESET=0; 
 190   1         FBH=0;  
 191   1         SHAPED_LEYING=1;//使上斜或下斜的引脚
 192   1       
 193   1         temp=0;    
 194   1      
 195   1        for(i=0;i<40;i++)
 196   1         {
 197   2           ADDRESS=temp;     //送地址
 198   2           DATA=TAB_Data[i];
 199   2           WR=0;
 200   2               WR=1;
 201   2               WR=0;
 202   2           temp++; 
 203   2         }
 204   1          update();
 205   1              delay(2);
 206   1      }
 207          
 208          
 209            void V_init(void)         
 210          
 211          {
 212   1                        
 213   1              MASTER_RESET=0;               
 214   1      
 215   1          
 216   1              ADDRESS=0x1d;
 217   1              DATA=0x00;
 218   1              WR=0;
 219   1              WR=1;
 220   1              WR=0;
 221   1              
 222   1              ADDRESS=0x1e;//倍频5倍，时钟为200MHz
 223   1              DATA=0x45;
 224   1              WR=0;
 225   1          WR=1;
 226   1              WR=0;
 227   1              
 228   1              ADDRESS=0x1f;
 229   1              DATA=0x00;
 230   1              WR=0;
 231   1          WR=1;
 232   1              WR=0;
 233   1              
 234   1              ADDRESS=0x20;
 235   1              DATA=0x40;
 236   1              WR=0;
 237   1          WR=1;
 238   1              WR=0;
 239   1      
 240   1              update();
 241   1      
C51 COMPILER V7.09   DDS_TEST                                                              04/29/2010 10:54:21 PAGE 5   

 242   1          delay(2);
 243   1      
 244   1        }
 245            
 246                        


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    413    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     45       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
